package practice_package;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.util.ArrayList;
import java.util.Properties;
import java.util.concurrent.TimeUnit;

import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.ss.usermodel.WorkbookFactory;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.edge.EdgeDriver;
import org.openqa.selenium.interactions.Actions;
import org.openqa.selenium.support.ui.Select;

public class OnlineBankingOpenTest 
{
	static {
		System.setProperty("webdriver.edge.driver", "./msedgedriver.exe");
	}
	public static void main(String[] args) throws Throwable 
	{
		//Read data from property file
		FileInputStream fis = new FileInputStream("./src/test/resources/CommonData1.properties");
		Properties p = new Properties();
		p.load(fis);
		String Url = p.getProperty("url");
		String staffid = p.getProperty("staffid");
		String pwd = p.getProperty("password");
		System.out.println(Url);
		System.out.println(staffid);
		System.out.println(pwd);
		
		
		//Enter the application
		WebDriver driver=new EdgeDriver();
		driver.manage().window().maximize();
		driver.manage().timeouts().implicitlyWait(10, TimeUnit.SECONDS);
		driver.get(Url);
		
		//create an account
		driver.findElement(By.xpath("//li[text()='Open Account']")).click();
		
		
		
		ArrayList<String> list = new ArrayList<String>();
		list.add("name");
		list.add("mobile");
		list.add("email");
		list.add("landline");
		list.add("pan_no");
		list.add("citizenship");
		list.add("homeaddrs");
		list.add("officeaddrs");
		list.add("pin");
		list.add("arealoc");
		list.add("nominee_name");
		list.add("nominee_ac_no");
		
		
		//Read data from excel file
		FileInputStream fi = new FileInputStream("./src/test/resources/TestData.xlsx");
		Workbook wb = WorkbookFactory.create(fi);
		Sheet sh = wb.getSheet("Open");
		Sheet sh1 = wb.getSheet("state");
		
		//for fields name,mobile,email
			
		for(int i=0;i<sh.getLastRowNum();i++)
		{
		String value = sh.getRow(i).getCell(1).getStringCellValue();
		driver.findElement(By.name(list.get(i))).sendKeys(value);
		
		}
	    
		
		//for date of birth
		driver.findElement(By.xpath("//input[@name='dob']")).click();
	    driver.findElement(By.xpath("//input[@name='dob']")).sendKeys("15-03-1990");
		
		
	    //for fields gender,state,city,account type
		ArrayList<String> list1 = new ArrayList<String>();
		list1.add("//input[@name='name']/../..//select[@name='gender']");
		list1.add("//select[@name='state']");
		list1.add("//select[@name='city']");
		list1.add("//select[@name='acctype']");
		
		for(int i=0;i<=sh1.getLastRowNum();i++)
		{
		String value1 = sh1.getRow(i).getCell(1).getStringCellValue();
		WebElement state = driver.findElement(By.xpath(list1.get(i)));
		Select s = new Select(state);
		s.selectByValue(value1);
		}
		
		//click on submit
		driver.findElement(By.xpath("//input[@name='submit']")).click();
		
		//click on reconfirm
		driver.findElement(By.xpath("//input[@name='cnfrm-submit']")).click();
	    
		//click on popup
		String text = driver.switchTo().alert().getText();
		//System.out.println(text);
		char ch[]=text.toCharArray();
		char ch1[]=new char[9];
		int j=0;
		for(int i=0;i<ch.length;i++)
		{
			if(ch[i]>='0'&&ch[i]<='9')
			{
				ch1[j]=(ch[i]);
				j++;
			}
		}
		String str = new String(ch1);
		System.out.println(str);
		
		driver.switchTo().alert().accept();
		
		//to insert the value into excel
	
      wb.getSheet("Application").getRow(0).createCell(1).setCellValue(str);
	  FileOutputStream fos = new FileOutputStream("./src/test/resources/TestData.xlsx");
	  wb.write(fos);
	  //wb.close();

		//staff login
				driver.findElement(By.xpath("//a[.='Staff Login']")).click();
				driver.findElement(By.xpath("//input[@name='staff_id']")).sendKeys(staffid);
				driver.findElement(By.xpath("//input[@name='password']")).sendKeys(pwd);
				driver.findElement(By.xpath("//input[@name='staff_login-btn']")).click();
		
		//ApprovePendingAccount
				driver.findElement(By.xpath("//input[@name='apprvac']")).click();
				driver.findElement(By.xpath("//input[@name='application_no']")).sendKeys(str);
				driver.findElement(By.xpath("//input[@name='search_application']")).click();
				String data = driver.findElement(By.xpath("//tbody/tr[2]")).getText();
				System.out.println(data);
				String text1 = driver.findElement(By.xpath("//th[.='Mobile']/../..//td[.='8987676763']")).getText();
				String actual = sh.getRow(1).getCell(1).getStringCellValue();
				if(text1.equals(actual))
				{
					System.out.println("details are displayed");
				}
				else {
					System.out.println("details are not displayed");
				}
				//click on approve
			
				driver.findElement(By.xpath("//input[@name='approve_cust']")).click();
				
				//to get text from popup
				 String text2 = driver.switchTo().alert().getText();
				//System.out.println(text2);
				char ch3[]=text2.toCharArray();
				char ch4[]=new char[13];
				 j=0;
				for(int i=0;i<ch3.length;i++)
				{
					if(ch3[i]>='0'&&ch3[i]<='9')
					{
						ch4[j]=(ch3[i]);
						j++;
					}
				}
				String str1 = new String(ch4);
				System.out.println(str1);
				
				//close the popup
				driver.switchTo().alert().accept();
				
			//to insert the value into excel
			 
		      wb.getSheet("Application").getRow(1).createCell(1).setCellValue(str1);
			  FileOutputStream fs = new FileOutputStream("./src/test/resources/TestData.xlsx");
			  wb.write(fs);
			  
				
				
		//click on home button of staff login
				driver.findElement(By.name("home")).click();
				
		//click on credit customer
				driver.findElement(By.name("credit_cust_ac")).click();
				driver.findElement(By.name("customer_account_no")).sendKeys(str1);
				driver.findElement(By.name("credit_amount")).sendKeys("10000");
				driver.findElement(By.name("credit_btn")).click();
				
			//To make popup disappear
				driver.switchTo().alert().accept();
				
		//logout staff login
				driver.findElement(By.name("logout_btn")).click();
		//home button of online banking
				driver.findElement(By.xpath("//a[.='Home']")).click();
		//Apply debit card
				driver.findElement(By.xpath("//li[.='Apply Debit Card']")).click();
				
				String name = sh.getRow(0).getCell(1).getStringCellValue();
				 String mob = sh.getRow(1).getCell(1).getStringCellValue();
				 String pan = sh.getRow(4).getCell(1).getStringCellValue();
				 String acc = wb.getSheet("Application").getRow(1).getCell(1).getStringCellValue();
				
				
				driver.findElement(By.name("holder_name")).sendKeys(name);
				driver.findElement(By.name("dob")).click();
				driver.findElement(By.name("dob")).sendKeys("15-03-1990");
				driver.findElement(By.name("pan")).sendKeys( pan);
				driver.findElement(By.name("mob")).sendKeys(mob);
				driver.findElement(By.name("acc_no")).sendKeys(acc);
				driver.findElement(By.name("dbt_crd_submit")).click();
				
				String text3 = driver.switchTo().alert().getText();
				//System.out.println(text3);
				//to get debit card number and pin
			
				
				char ch5[]=text3.toCharArray();
				String st1 = " ";
				String st2 = " ";
				int count=0;
				for(int i=0;i<ch5.length;i++)
				{
					if(ch5[i]>='0'&&ch5[i]<='9')
					{
						if(count<12)
						{
							st1=st1+ch5[i];
						    count++;
						}
						else {
							st2=st2+ch5[i];
						}
					}
				}
				System.out.println(st1);
				System.out.println(st2);
				
				driver.switchTo().alert().accept();
			//to write in excel
				 wb.getSheet("Application").getRow(3).createCell(1).setCellValue(st1);
				 wb.getSheet("Application").getRow(4).createCell(1).setCellValue(st2); 
				 
				 FileOutputStream f1 = new FileOutputStream("./src/test/resources/TestData.xlsx");
				  wb.write(f1);
				
				
				
		//click on  home button
				
				driver.findElement(By.xpath("//a[.='Home']")).click();
				
		//click on internet banking
				Actions a=new Actions(driver);
				WebElement move = driver.findElement(By.xpath("//div[@class='ebanking']"));
				a.moveToElement(move).perform();
				
				//click on register
				driver.findElement(By.xpath("//li[.='Register']")).click();
				
				//enter details
				String name1 = sh.getRow(0).getCell(1).getStringCellValue();
				String mob1 = sh.getRow(1).getCell(1).getStringCellValue();
				 String pan1 = sh.getRow(4).getCell(1).getStringCellValue();
				 String acc1 = wb.getSheet("Application").getRow(1).getCell(1).getStringCellValue();
				 String pass = wb.getSheet("Application").getRow(2).getCell(1).getStringCellValue();
				 String debnum = wb.getSheet("Application").getRow(3).getCell(1).getStringCellValue();
				 String debpin = wb.getSheet("Application").getRow(4).getCell(1).getStringCellValue();
				
				
				driver.findElement(By.name("holder_name")).sendKeys(name1);
				driver.findElement(By.name("accnum")).sendKeys(acc1);
				driver.findElement(By.name("dbtcard")).sendKeys(debnum);
				driver.findElement(By.name("dbtpin")).sendKeys(debpin);
				driver.findElement(By.name("mobile")).sendKeys(mob1);
				driver.findElement(By.name("pan_no")).sendKeys(pan1);
				driver.findElement(By.name("dob")).click();
				driver.findElement(By.name("dob")).sendKeys("15-03-1990");
				driver.findElement(By.name("last_trans")).sendKeys("10000");
				driver.findElement(By.name("password")).sendKeys(pass);
				driver.findElement(By.name("cnfrm_password")).sendKeys(pass);
						
				driver.findElement(By.name("submit")).click();
				
				//click on popup
				String text4 = driver.switchTo().alert().getText();
				
				//to get customer id
				
				char ch7[]=text4.toCharArray();
				char ch8[]=new char[7];
				 j=0;
				for(int i=0;i<ch7.length;i++)
				{
					if(ch7[i]>='0'&&ch7[i]<='9')
						
					{
						ch8[j]=(ch7[i]);
						j++;
					}
				}
				String st4 = new String(ch8);
				System.out.println(st4);
				
				//to write in excel
				wb.getSheet("Application").getRow(5).createCell(1).setCellValue(st4);
				FileOutputStream f2 = new FileOutputStream("./src/test/resources/TestData.xlsx");
				wb.write(f2);
				
				driver.switchTo().alert().accept();
				//click on home
				driver.findElement(By.xpath("//a[.='Home']")).click();
				
				//move to internet banking
				Actions a1=new Actions(driver);
				WebElement move1 = driver.findElement(By.xpath("//div[@class='ebanking']"));
				a1.moveToElement(move1).perform();
				
				//login of internet banking
				driver.findElement(By.xpath("//li[.='Login ']")).click();
				
				//enter the details
				String id = wb.getSheet("Application").getRow(5).getCell(1).getStringCellValue();
				
				
				 
				driver.findElement(By.name("customer_id")).sendKeys(id);
				driver.findElement(By.name("password")).sendKeys(pass);
				driver.findElement(By.name("login-btn")).click();
				
				
				//fund transfer
				driver.findElement(By.xpath("//li[.='Fund Transfer']")).click();
				
				//click on add beneficiary
				driver.findElement(By.name("add_beneficiary")).click();
				
				//get values from excel
				
				ArrayList<String> li = new ArrayList<String>();
				li.add("beneficiary_name");
				li.add("beneficiary_acno");
				li.add("Ifsc_code");
				
				Sheet sh3 = wb.getSheet("beneficiary");
				for(int i=0;i<sh3.getLastRowNum();i++)
				{
				String data1 = sh3.getRow(i).getCell(1).getStringCellValue();
				driver.findElement(By.name(li.get(i))).sendKeys(data1);
				}
				
				//click on add beneficiary
				String type1 = sh3.getRow(3).getCell(1).getStringCellValue();
				WebElement atype = driver.findElement(By.xpath("//select[@name='beneficiary_acc_type']"));
				Select s2=new Select(atype);
				s2.selectByValue(type1);
				driver.findElement(By.name("add_beneficiary_btn")).click();
				//click on popup
				driver.switchTo().alert().accept();
				//click on fund transfer
				driver.findElement(By.xpath("//li[.='Fund Transfer']")).click();
				
				//select beneficiary
				WebElement bene = driver.findElement(By.xpath("//select[@name='beneficiary']"));
				Select s4 = new Select(bene);
				s4.selectByIndex(1);
				
				driver.findElement(By.name("trnsf_amount")).sendKeys("500");
				
				driver.findElement(By.name("fnd_trns_btn")).click();
				
				String Otp = driver.findElement(By.xpath("//label[@class='OTP_msg']")).getText();
				System.out.println(Otp);
				char chh[]=Otp.toCharArray();
				String st13 = " ";
				
				int count1=0;
				for(int i=chh.length-1;i>=0;i--)
				{
					if(chh[i]>='0'&&chh[i]<='9')
					{
						if(count1<6)
						{
							st13=st13+chh[i];
						    count1++;
						}
						else {
							
						}
					}
				}
				System.out.println(st13);
				StringBuilder st14 = new StringBuilder(st13);
				st14.reverse();
				System.out.println(st14);
				
				//verify OTP
				driver.findElement(By.name("otpcode")).sendKeys(st14);
				driver.findElement(By.name("verify-btn")).click();
				
				                                                                  
				//click on popup
				String text6 = driver.switchTo().alert().getText();
				System.out.println(text6);
				driver.switchTo().alert().accept();
				
				
				
		}

}
